# 产品需求文档 (PRD)
## 地球新主 - Earthlord

**版本**: v1.0
**文档日期**: 2025-12-24
**项目类型**: LBS生存类手游
**目标平台**: iOS (出海全球175国)

---

## 1. 项目概述

### 1.1 项目背景
在AI辅助开发的时代，《地球新主》是一款利用AI工具开发的LBS（基于位置的服务）生存类手游。该项目证明了：
- **开发效率**: 1人 vs 传统10-15人团队
- **开发周期**: 3周 vs 传统6-9个月
- **开发成本**: ¥1.5万 vs 传统¥150-300万
- **代码产出**: 2,291行/天 vs 传统200行/天
- **代码规模**: 48,000+行已验证商业代码

### 1.2 产品定位
一款以"希望朋克"为视觉风格的末日生存LBS手游，玩家通过GPS圈地、探索真实地标、收集资源、建造家园，在废墟之上重建文明。

**核心差异化**:
- 真实世界与虚拟游戏的融合（类似宝可梦GO）
- Walk to Earn 健康激励机制
- 以物易物的社交经济系统
- 硬核生存体征管理

### 1.3 世界观设定
- **2048年**: "终末战争"爆发，全球文明在72小时内崩塌，99%人口消失
- **2051年**: 幸存者从废墟中走出，《新开拓者协议》颁布
- **核心法则**: "凡以双足丈量之无主土地，皆为开拓者所有"
- **视觉风格**: "希望朋克" - 废土之上的新生，绝望中的希望

---

## 2. 目标用户

### 2.1 核心用户画像

**主要用户群体**:
1. **运动健康爱好者** (30%)
   - 年龄: 25-40岁
   - 需求: 寻找运动激励，步行/跑步打卡
   - 参考产品: Keep、悦跑圈

2. **位置游戏玩家** (40%)
   - 年龄: 18-35岁
   - 需求: 探索真实世界，收集要素
   - 参考产品: 宝可梦GO、Ingress

3. **生存游戏爱好者** (20%)
   - 年龄: 20-35岁
   - 需求: 资源管理、建造、硬核体验
   - 参考产品: 饥荒、方舟、Rust

4. **社交用户** (10%)
   - 年龄: 18-30岁
   - 需求: 基于位置的社交、交易、协作
   - 参考产品: 附近的人、同城交友

### 2.2 市场规模
- **全球LBS游戏市场**: 宝可梦GO累计收入超60亿美元，证明市场成熟
- **目标市场**: App Store 175国家和地区
- **预期用户**: 第一年10万DAU，第二年50万DAU

---

## 3. 游戏核心循环

```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                              ↓
    │         ┌──────────────────────────────┐
    │         │  资源用途：                    │
    │         │  • 建造建筑（消耗资源）         │
    │         │  • 交易换物（流通资源）         │
    │         │  • 生存消耗（食物/水）          │
    │         └──────────────────────────────┘
    │                              ↓
    └──────── 通讯社交 ← 成就排行 ← 发展壮大
```

**关键设计逻辑**: 先圈地有了"家"，再探索获得"资源"，然后才能建造和交易

---

## 4. 功能需求详述

### 第一部分：登录与圈地系统

#### 4.1 登录注册系统
**优先级**: P0（必须）

**功能需求**:
- 支持三种登录方式:
  - 邮箱注册（用户名+密码）
  - Apple Sign In（一键登录）
  - Google Sign In（海外用户）
- 自动会话管理
- 邮箱验证功能
- 密码重置功能
- 多设备登录支持

**技术实现**:
- 后端: Supabase Auth
- 核心代码: `AuthManager.swift` (380行)

**验收标准**:
- 登录成功率 > 99%
- 登录耗时 < 2秒
- OAuth登录一键完成

---

#### 4.2 GPS圈地系统
**优先级**: P0（核心玩法）

**功能需求**:
- 实时GPS轨迹追踪
- 卫星地图显示（MapKit）
- 轨迹可视化（蓝色线条）
- 自动闭合检测（回到起点自动闭合）
- 领地验证规则:
  - 最小面积: 100m²
  - 最大面积: 100,000m²
  - 不得与他人领地重叠
  - GPS精度验证（防作弊）
- 领地永久保存

**技术实现**:
- 地图: Apple MapKit（免费、全球可用）
- 定位: CoreLocation
- 数据库: Supabase + PostGIS（地理空间数据）
- 核心代码: `LocationManager.swift` (950行)

**验收标准**:
- GPS精度 < 10米
- 轨迹绘制延迟 < 500ms
- 闭合检测准确率 100%
- 重叠检测准确率 100%

**防作弊机制**:
- GPS速度检测（步行速度 < 8km/h）
- 轨迹平滑度检测
- 定位源验证

---

#### 4.3 领地管理
**优先级**: P0

**功能需求**:
- 领地信息展示:
  - 自定义名称
  - 面积计算（平方米）
  - 建筑数量统计
  - 创建时间
  - 状态（活跃/休眠）
- 领地设置:
  - 允许/禁止交易开关
  - 领地描述
- 领地活跃度机制:
  - 30天内必须开始建设
  - 90天内必须保持活跃
  - 否则回收机制

**技术实现**:
- 数据库: Supabase PostgreSQL + PostGIS
- 核心代码: `TerritoryManager.swift`

**验收标准**:
- 面积计算误差 < 1%
- 数据同步延迟 < 1秒

---

### 第二部分：探索与资源获取

#### 4.4 POI发现与搜刮
**优先级**: P0（核心玩法）

**功能需求**:
- 基于真实地标的POI系统
- POI类型与资源对应:
  - 医院/药店 → 药品（急救包、抗生素）
  - 超市/餐厅 → 食物（罐头、饮用水）
  - 工厂/工地 → 金属材料
  - 公园/林地 → 木材
  - 银行/珠宝店 → 稀有材料
- 地理围栏触发（进入100米范围）
- 搜刮冷却时间（同一POI 24小时冷却）
- 探索成就记录（距离、时长）
- 随机掉落机制

**技术实现**:
- POI数据源: Apple MapKit（免费）
- 地理围栏: CoreLocation Region Monitoring
- 核心代码: `POIManager.swift`, `ExplorationManager.swift` (1400行)

**验收标准**:
- POI识别准确率 > 95%
- 触发范围误差 < 20米
- 资源掉落符合配置表

---

#### 4.5 背包系统
**优先级**: P0

**功能需求**:
- 背包容量限制（初始100格，可升级）
- 物品分类展示:
  - 生存类（食物、水）
  - 材料类（木材、金属、石头）
  - 工具类
  - 稀有材料
- 物品数量堆叠
- 物品使用/丢弃功能
- 背包扩容机制（建造仓库）

**技术实现**:
- 本地优先架构（离线可用）
- 异步同步到云端
- 核心代码: `ItemManager.swift`

**验收标准**:
- 离线模式可用
- 数据同步无冲突
- 物品操作响应 < 200ms

---

### 第三部分：建造与交易系统

#### 4.6 建造系统
**优先级**: P0

**功能需求**:
- 15种建筑，分为4大类:
  - **生存类**: 篝火、庇护所
  - **储存类**: 小/中/大仓库
  - **生产类**: 农田、工作台、水井
  - **能源类**: 太阳能板、风力发电机
- 建筑等级系统（Tier 1/2/3）
- 建造需求:
  - 检查资源是否充足
  - 只能在自己领地内建造
  - 位置拖拽选择
- 建造过程:
  - 消耗资源
  - 建造中状态
  - 完成后待激活

**技术实现**:
- 建筑模板配置表
- 资源检查逻辑
- 核心代码: `BuildingManager.swift`

**验收标准**:
- 资源检查准确率 100%
- 建造成功率 > 99.9%
- 建筑状态正确流转

---

#### 4.7 建筑状态管理
**优先级**: P1

**功能需求**:
- 建筑状态机:
  - 建造中 → 待激活 → 运行中 ↔ 损坏
- 状态操作:
  - 激活（启动设施）
  - 升级（提升等级）
  - 维修（修复损坏）
  - 拆除（回收部分资源）
- 状态限制:
  - 只有运行中可升级
  - 损坏需先维修

**验收标准**:
- 状态流转符合规则
- 非法操作正确拦截

---

#### 4.8 交易系统
**优先级**: P1

**功能需求**:
- 以物易物机制:
  - 发布挂单（我提供 → 我需要）
  - 浏览附近挂单（100米范围内可见）
  - 接受交易
  - 取消挂单
- 交易限制:
  - 只能在双方都开启"允许交易"的领地
  - 必须在100米范围内
  - 资源充足检查
- 交易记录

**技术实现**:
- 基于位置的查询（PostGIS）
- 核心代码: `TradeManager.swift`

**验收标准**:
- 位置过滤准确
- 交易原子性保证
- 防止资源重复消耗

---

### 第四部分：通讯系统

#### 4.9 消息中心
**优先级**: P1

**功能需求**:
- 官方消息推送:
  - 生存指南
  - 每日任务
  - 官方公告
  - 活动通知
- 消息分类
- 未读标记

**技术实现**:
- Supabase Realtime推送
- 核心代码: `RadioManager.swift`

---

#### 4.10 公共频道聊天
**优先级**: P1

**功能需求**:
- 基于位置的公共聊天室（3km范围）
- 实时消息收发
- 消息历史记录
- 屏蔽/举报功能

**技术实现**:
- Supabase Realtime（WebSocket）
- 核心代码: `CommunicationManager.swift`

**验收标准**:
- 消息延迟 < 500ms
- 范围过滤准确

---

#### 4.11 频道管理
**优先级**: P2

**功能需求**:
- 创建私人频道
- 加入/退出频道
- 频道列表（显示距离、在线人数）
- 频道聊天

**技术实现**:
- 核心代码: `ChannelManager.swift`

---

#### 4.12 PTT呼叫
**优先级**: P2

**功能需求**:
- 模拟对讲机操作
- 长按发送语音（Push to Talk）
- 频率切换
- 音频录制与播放

**验收标准**:
- 长按操作流畅
- 音频质量清晰
- 延迟 < 1秒

---

### 第五部分：个人中心与商业化

#### 4.13 个人主页
**优先级**: P0

**功能需求**:
- 玩家档案展示:
  - 幸存者等级
  - 存活天数
  - 领地数量和总面积
  - 建筑数量
  - 探索距离
- 头像/昵称设置
- 个性签名

---

#### 4.14 多语言设置
**优先级**: P0（出海必备）

**功能需求**:
- 支持语言:
  - 简体中文
  - 繁体中文
  - English
  - 日本語（规划中）
  - 한국어（规划中）
- 切换后全局生效
- 重启应用生效

**技术实现**:
- iOS国际化（NSLocalizedString）
- AI辅助翻译

---

#### 4.15 付费订阅系统
**优先级**: P0（变现核心）

**功能需求**:
- 订阅制:
  - 开拓者月卡 $9.99/月
    - 无限探索次数
    - 探索范围扩大50%
    - 资源掉落+20%
  - 领主通行证 $19.99/月
    - 月卡所有特权
    - 建造时间减半
    - 交易手续费免除
- 一次性购买:
  - 初级物资包 $0.99
  - 中级物资包 $2.99
  - 高级物资包 $4.99
  - 稀有资源包 $9.99

**技术实现**:
- StoreKit 2（苹果官方）
- 自动续费管理
- 核心代码: `StoreKitManager.swift`

**验收标准**:
- 支付成功率 > 99%
- 自动续费正常
- 购买记录同步

---

#### 4.16 排行榜
**优先级**: P1

**功能需求**:
- 三个榜单:
  - 领地面积榜
  - 探索废墟榜
  - 建筑数量榜
- 实时排名更新（5分钟缓存）
- 显示前100名
- 自己的排名高亮

**技术实现**:
- 数据库窗口函数
- 缓存机制
- 核心代码: `LeaderboardManager.swift`

**验收标准**:
- 10万用户下查询 < 500ms
- 排名准确

---

#### 4.17 成就系统
**优先级**: P1

**功能需求**:
- 成就分类:
  - 新手成就（引导）
  - 进阶成就
  - 稀有成就
  - 传说成就
- 成就稀有度:
  - 普通（白）
  - 稀有（蓝）
  - 史诗（紫）
  - 传说（橙）
- 成就奖励（金币）
- 完成度统计

**技术实现**:
- EventBus（事件总线）
- 发布-订阅模式
- 核心代码: `AchievementManager.swift`

---

#### 4.18 生存体征
**优先级**: P1

**功能需求**:
- 三大体征:
  - 核心生命值（0-100）
  - 饱食度（0-100%）
  - 水分（0-100%）
- 时间衰减机制:
  - 饱食度: -5/小时
  - 水分: -10/小时
  - 低于阈值扣生命值
- 增益机制:
  - 饱食度/水分 > 80% 时获得探索/建造加成
- 使用物品恢复

**技术实现**:
- 后台定时器（10分钟检查）
- 核心代码: `VitalSignsManagerV2.swift`

**验收标准**:
- 衰减计算准确
- 后台运行正常
- 状态同步及时

---

## 5. 技术架构

### 5.1 技术栈

**前端（iOS）**:
- 语言: Swift 5.x
- UI框架: SwiftUI
- 地图: Apple MapKit
- 定位: CoreLocation
- 支付: StoreKit 2
- 存储: UserDefaults + Core Data（本地）

**后端（BaaS）**:
- 平台: Supabase
- 数据库: PostgreSQL + PostGIS
- 认证: Supabase Auth
- 实时通讯: Supabase Realtime
- 存储: Supabase Storage

**开发工具**:
- IDE: Xcode
- 版本控制: Git
- AI辅助: Claude/Cursor

### 5.2 架构模式
- MVVM（Model-View-ViewModel）
- 本地优先架构（Local-First）
- 事件驱动（EventBus）

### 5.3 核心Manager清单
| Manager | 功能 | 代码量 |
|---------|------|--------|
| AuthManager | 用户认证 | 380行 |
| LocationManager | GPS定位与圈地 | 950行 |
| TerritoryManager | 领地管理 | 600行 |
| POIManager | 地标发现 | 500行 |
| ExplorationManager | 探索搜刮 | 900行 |
| ItemManager | 背包物品 | 700行 |
| BuildingManager | 建造系统 | 1200行 |
| TradeManager | 交易系统 | 800行 |
| CommunicationManager | 通讯聊天 | 1500行 |
| ChannelManager | 频道管理 | 600行 |
| RadioManager | 消息推送 | 400行 |
| StoreKitManager | 内购支付 | 900行 |
| LeaderboardManager | 排行榜 | 500行 |
| AchievementManager | 成就系统 | 700行 |
| VitalSignsManagerV2 | 生存体征 | 600行 |

**总计**: 48,000+行代码

---

## 6. 商业化策略

### 6.1 变现模式

**主要收入来源**:
1. **订阅收入（70%）**
   - 开拓者月卡: $9.99/月
   - 领主通行证: $19.99/月
   - 目标转化率: 5%
   - 预期: 10万DAU × 5% × $9.99 = $49,950/月

2. **内购道具（25%）**
   - 资源包销售
   - 装备升级
   - 目标ARPPU: $5
   - 预期: 10万DAU × 20% × $5 = $100,000/月

3. **广告收入（5%）**
   - 视频激励广告（免费用户）
   - 预期: eCPM $5，10万展示/天

**第一年收入预测**:
- Q1: $50K（冷启动）
- Q2: $200K（增长期）
- Q3: $400K（爆发期）
- Q4: $600K（稳定期）
- **年收入**: $1.25M

### 6.2 付费点设计
- 免费用户: 基础游戏体验，探索次数限制
- 付费用户: 解锁限制，加速发展
- 核心原则: Pay to Win Faster（付费加速，不影响平衡）

---

## 7. 开发里程碑

### Phase 1: MVP（最小可行产品）- 4周
- Week 1: 登录 + GPS圈地
- Week 2: POI探索 + 背包
- Week 3: 建造系统
- Week 4: 基础UI + 测试

### Phase 2: 核心功能完善 - 4周
- Week 5-6: 交易系统 + 通讯系统
- Week 7: 成就 + 排行榜
- Week 8: 付费系统 + App Store上架

### Phase 3: 内容丰富 - 4周
- Week 9-10: 新建筑、新资源
- Week 11: 生存体征系统
- Week 12: 优化与bug修复

### Phase 4: 运营与迭代 - 持续
- 每月1-2次版本更新
- 活动运营
- 用户反馈迭代

---

## 8. 成功指标 (KPI)

### 8.1 用户指标
- **DAU**: 第3个月达到1万，第12个月达到10万
- **留存率**:
  - 次日留存 > 40%
  - 7日留存 > 20%
  - 30日留存 > 10%
- **活跃时长**: 日均30分钟

### 8.2 核心行为指标
- **圈地**: 每用户平均2块领地
- **探索**: 每周3次以上
- **建造**: 每领地平均5个建筑
- **交易**: 每周1次以上

### 8.3 商业指标
- **付费率**: 5%
- **ARPPU**: $15/月
- **LTV**: $100（生命周期价值）
- **CAC**: < $20（用户获取成本）
- **LTV/CAC**: > 5

---

## 9. 风险与应对

### 9.1 技术风险
- **GPS精度问题**:
  - 应对: 多重验证 + 精度阈值
- **作弊风险**:
  - 应对: GPS速度检测 + 轨迹平滑度检测
- **服务器成本**:
  - 应对: Supabase免费额度 + 缓存优化

### 9.2 运营风险
- **用户增长缓慢**:
  - 应对: 病毒式传播机制 + KOL合作
- **内容消耗快**:
  - 应对: 定期更新新建筑/新玩法
- **付费率低**:
  - 应对: A/B测试优化付费点

### 9.3 政策风险
- **地图数据合规**:
  - 应对: 使用官方MapKit，符合各国法规
- **用户隐私**:
  - 应对: 隐私政策完善，数据加密存储

---

## 10. 附录

### 10.1 竞品分析
| 产品 | 优势 | 劣势 | 借鉴点 |
|------|------|------|--------|
| 宝可梦GO | IP强大，用户基数大 | 玩法单一 | LBS+收集玩法 |
| Ingress | 社交强 | 学习曲线陡 | 领地争夺机制 |
| Zombies Run | 运动激励好 | 缺乏持久玩法 | 剧情沉浸感 |
| 饥荒 | 生存机制硬核 | 纯单机 | 资源管理+建造 |

### 10.2 目标市场优先级
1. **Tier 1**: 美国、日本、韩国、加拿大（高ARPU）
2. **Tier 2**: 欧洲主要国家（英法德）
3. **Tier 3**: 东南亚（用户量大）
4. **Tier 4**: 中国（需单独版本）

---

## 文档变更记录
| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | 2025-12-24 | AI | 初始版本 |

---

**文档审核**:
- [ ] 产品经理审核
- [ ] 技术负责人审核
- [ ] UI/UX设计师审核
- [ ] 商务负责人审核
