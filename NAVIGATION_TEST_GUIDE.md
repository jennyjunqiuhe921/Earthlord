# 探索模块导航测试指南

## 完整导航流程

```
主 TabView
    └─ 资源 Tab (tag 2)
        └─ ResourcesTabView
            └─ POI 分段
                └─ POIListView
                    └─ [点击 POI 卡片]
                        └─ POIDetailView
                            └─ [点击"搜寻此POI"]
                                └─ ExplorationResultView (sheet)
                                    └─ [点击"确认"]
                                        └─ 关闭弹窗，回到 POIDetailView
                                            └─ [点击返回按钮]
                                                └─ 回到 POIListView
```

## 测试步骤

### 步骤 1: 进入资源 Tab
1. 启动 App
2. 点击底部 TabBar 的 **"资源"** Tab（shippingbox.fill 图标）
3. ✅ 验证：进入 ResourcesTabView，顶部显示 "资源" 标题

### 步骤 2: 选择 POI 分段
1. 在 ResourcesTabView 中，默认应该已选中 **"POI"** 分段
2. 如果不是，点击分段选择器中的 **"POI"**
3. ✅ 验证：看到 POIListView 页面，显示：
   - GPS 坐标 (22.54, 114.06)
   - "附近发现 X 个地点"
   - 搜索按钮
   - 分类筛选工具栏
   - POI 列表（5 个 POI）

### 步骤 3: 点击 POI 卡片
1. 在 POI 列表中找到 **"废弃超市"** 卡片
   - 绿色图标 (cart.fill)
   - 状态：已发现
   - 标签：有物资
2. 点击整个卡片区域
3. ✅ 验证：跳转到 POIDetailView，显示：
   - 顶部绿色渐变背景
   - 大购物车图标 (80pt)
   - 底部半透明遮罩显示 "废弃超市" 和 "超市"

### 步骤 4: 查看 POI 详情
在 POIDetailView 中，向下滚动查看：

1. **描述卡片**
   - 显示地点描述文字

2. **信息区域**（5 项信息）
   - 距离：350m
   - 物资状态：有物资（带箱子图标）
   - 危险等级：低危（蓝色）
   - 发现状态：已发现（蓝色眼睛图标）
   - 来源：地图数据

3. **操作按钮**
   - 主按钮："搜寻此POI"（橙色渐变）
   - 次要按钮："标记已发现"、"标记无物资"

✅ 验证：所有信息正确显示

### 步骤 5: 点击"搜寻此POI"
1. 点击橙色渐变的 **"搜寻此POI"** 按钮
2. ✅ 验证：从底部弹出 ExplorationResultView (sheet)，显示：
   - 成就标题区域
     - 光圈效果
     - 大地图图标（橙色渐变圆形背景）
     - "探索完成！" 标题
     - "成功探索新区域" 副标题

### 步骤 6: 查看探索结果
在 ExplorationResultView 中，向下滚动查看：

1. **统计数据卡片**
   - 行走距离
     - 本次：2.5 km
     - 累计：15 km
     - 排名：#42（绿色徽章）
   - 探索面积
     - 本次：50000 m²
     - 累计：250000 m²
     - 排名：#38（绿色徽章）
   - 探索时长：30分0秒

2. **奖励物品卡片**
   - 标题："获得物品"（礼物图标）
   - 物品列表：
     - 木材 x5（灰色立方体图标，绿色对勾）
     - 矿泉水 x3（蓝色水滴图标，绿色对勾）
     - 罐头食品 x2（棕色餐具图标，绿色对勾）
   - 底部提示："已添加到背包"（绿色背景）

3. **确认按钮**
   - 橙色渐变大按钮："确认"

✅ 验证：所有数据正确显示，排名徽章为绿色（11-50名）

### 步骤 7: 关闭探索结果
1. 点击 **"确认"** 按钮
2. ✅ 验证：
   - 弹窗从底部滑出消失
   - 回到 POIDetailView（废弃超市详情页）
   - 所有信息保持不变

### 步骤 8: 返回 POI 列表
1. 点击左上角的 **返回按钮** (< 资源)
2. ✅ 验证：
   - 返回到 POIListView
   - POI 列表完整显示
   - 分段选择器仍选中 "POI"

### 步骤 9: 测试其他分段
1. 点击 **"背包"** 分段
2. ✅ 验证：显示 BackpackView，包含：
   - 容量状态卡（64/100，进度条）
   - 搜索框
   - 分类筛选
   - 8 个物品卡片

3. 点击 **"已购"** 分段
4. ✅ 验证：显示占位视图 "已购功能开发中，敬请期待"

5. 点击 **"领地"** 分段
6. ✅ 验证：显示占位视图 "领地功能开发中，敬请期待"

7. 点击 **"交易"** 分段
8. ✅ 验证：显示占位视图 "交易功能开发中，敬请期待"

## 附加测试

### 测试 POI 筛选
1. 在 POI 列表页，点击筛选工具栏的 **"医院"** 按钮
2. ✅ 验证：只显示医院类型的 POI（医院废墟）
3. 点击 **"全部"** 按钮
4. ✅ 验证：显示所有 5 个 POI

### 测试搜索功能
1. 点击 **"搜索附近POI"** 按钮
2. ✅ 验证：
   - 按钮文字变为 "搜索中..."
   - 显示加载动画
   - 1.5 秒后恢复正常
   - 控制台输出 "✅ 搜索完成"

### 测试已搜空的 POI
1. 在 POI 列表中点击 **"医院废墟"**
2. ✅ 验证：
   - 详情页显示红色渐变背景
   - 物资状态：已清空
   - 主按钮显示 "已搜空"（灰色，禁用状态）
   - 无法点击主按钮

### 测试背包搜索
1. 切换到 **"背包"** 分段
2. 在搜索框输入 **"水"**
3. ✅ 验证：只显示 "矿泉水" 物品
4. 清空搜索框
5. ✅ 验证：显示所有 8 个物品

### 测试背包筛选
1. 在背包页，点击 **"食物"** 分类按钮
2. ✅ 验证：只显示 "罐头食品"
3. 点击 **"全部"**
4. ✅ 验证：显示所有物品

### 测试交易开关
1. 在资源页顶部，打开 **"交易功能"** 开关
2. ✅ 验证：
   - 开关变为绿色
   - 左侧图标变为绿色
3. 关闭开关
4. ✅ 验证：
   - 开关变为灰色
   - 左侧图标变为灰色

## 预期的控制台输出

在测试过程中，控制台应该输出以下调试信息：

```
🔍 开始搜寻 POI: 废弃超市
✅ 搜索完成
```

## 已知的设计特性

1. **POI 列表中的 5 个 POI**：
   - 废弃超市（已发现，有物资）- 绿色
   - 医院废墟（已搜空）- 红色
   - 郊外加油站（未发现，有物资）- 橙色
   - 药店废墟（已发现，有物资）- 紫色
   - 工厂废墟（未发现，有物资）- 灰色

2. **背包中的 8 种物品**：
   - 矿泉水 x3
   - 罐头食品 x5
   - 绷带 x8（良好品质）
   - 抗生素药品 x2（普通品质）
   - 木材 x12
   - 废金属 x7
   - 手电筒 x1（优秀品质）
   - 尼龙绳 x2（良好品质）

3. **探索结果固定数据**：
   - 距离：本次 2.5km，累计 15km，排名 #42
   - 面积：本次 5万m²，累计 25万m²，排名 #38
   - 时长：30分钟
   - 获得物品：木材x5、矿泉水x3、罐头x2

## 故障排除

### 如果导航不工作
1. 确保 ResourcesTabView 有 NavigationView
2. 确保 POIListView 使用 NavigationLink
3. 重新构建项目

### 如果弹窗不显示
1. 检查 POIDetailView 的 @State showExplorationResult
2. 确保 sheet modifier 正确绑定
3. 检查控制台是否有错误

### 如果返回按钮不显示
1. 确保在 NavigationView 内部
2. 检查 navigationBarTitleDisplayMode 设置

## 总结

完整的导航流程已经实现：
- ✅ Tab 切换
- ✅ 分段选择器
- ✅ NavigationLink 跳转
- ✅ Sheet 弹窗
- ✅ Dismiss 关闭
- ✅ 返回按钮

所有页面都在同一个 NavigationView 层级下，导航体验流畅自然！
